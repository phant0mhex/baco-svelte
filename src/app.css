@import "tailwindcss";
@plugin "@tailwindcss/typography";
@plugin "@tailwindcss/forms";

/* Variante dark mode automatique */
@variant dark (&:where(.dark, .dark *));

/* --- COUCHE DE BASE --- */
@layer base {
  :root {
    /* Valeurs par défaut (Deep Space) */
    --color-primary: 59, 130, 246; 
    --color-glow: 147, 197, 253;
    --glass-border: rgba(255, 255, 255, 0.1);
    --bg-gradient-from: rgba(56, 189, 248, 0.15);
    --bg-gradient-to: rgba(236, 72, 153, 0.15);
  }
  
  body {
    @apply bg-gray-50 text-gray-900;
  }
  .dark body {
    @apply bg-gray-900 text-gray-100;
  }
}

/* --- CONFIGURATION DU THÈME --- */
@theme {
  /* Mappe les variables CSS aux utilitaires Tailwind */
  --color-primary: var(--color-primary);
  --color-secondary: var(--color-secondary);
  --color-success: var(--color-success);
  --color-warning: var(--color-warning);
  --color-error: var(--color-error);
  --color-primary-hover: var(--color-primary-hover);
}

/* --- UTILITAIRES PERSONNALISÉS --- */
@layer utilities {
  /* 1. Le fond global "Cosmic" dynamique */
  .bg-deep-space {
    background-color: #0f172a;
    background-image: 
        radial-gradient(at 0% 0%, var(--bg-gradient-from) 0px, transparent 50%),
        radial-gradient(at 100% 0%, var(--bg-gradient-to) 0px, transparent 50%),
        /* Les deux suivants restent fixes pour donner de la profondeur, ou vous pouvez aussi créer des variables pour eux */
        radial-gradient(at 100% 100%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
        radial-gradient(at 0% 100%, rgba(16, 185, 129, 0.15) 0px, transparent 50%);
    background-attachment: fixed;
  }

  /* 2. Panneaux de verre avec bordure dynamique */
  .glass-panel {
    background-color: var(--glass-bg, rgba(255, 255, 255, 0.05)); /* Fallback au cas où */
    backdrop-filter: blur(12px);
    @apply bg-white/10 dark:bg-gray-900/30 backdrop-blur-md shadow-xl;
    border: 1px solid var(--glass-border);
  }
  
  /* 3. Effet de survol pour le verre */
  .glass-hover {
    @apply transition-all duration-300 hover:bg-white/20 dark:hover:bg-gray-800/50 hover:scale-[1.02] hover:shadow-2xl hover:border-white/30;
  }
  
  /* 4. Texte coloré dynamiquement selon le thème */
  .text-theme-primary {
    color: rgb(var(--color-primary));
  }
  
  /* 5. Bordure colorée dynamiquement selon le thème */
  .border-theme-primary {
    border-color: rgba(var(--color-primary), 0.3);
  }
}

/* --- COMPOSANTS & OVERRIDES --- */
@layer components {
  /* Carta Markdown Overrides */
  .carta-preview {
    @apply prose prose-sm max-w-none dark:prose-invert p-4;
    background-color: transparent;
  }

  .dark .carta-input {
    background-color: #1f2937 !important;
    color: #e5e7eb !important;
  }
  
  .carta-editor {
    border: none !important;
  }
}



/* =========================================
   NOUVEAUX ÉLÉMENTS D'AMBIANCE
   ========================================= */

/* --- 1. THÈME OCÉAN : BULLES --- */
.ocean-bubbles {
    display: none;
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1; /* Derrière le contenu */
    pointer-events: none;
}

.theme-ocean .ocean-bubbles {
    display: block;
}

.bubble-layer {
    position: absolute;
    width: 100%;
    height: 100%;
    /* Création de bulles via des dégradés radiaux multiples */
    background-image: 
        radial-gradient(rgba(255, 255, 255, 0.15) 1px, transparent 2px),
        radial-gradient(rgba(255, 255, 255, 0.10) 2px, transparent 3px),
        radial-gradient(rgba(255, 255, 255, 0.20) 1px, transparent 2px);
    background-size: 50px 50px, 100px 100px, 150px 150px;
    background-position: 0 0, 0 0, 0 0;
    animation: rise 20s linear infinite;
}

@keyframes rise {
    0% { background-position: 0 100vh, 20px 100vh, 50px 100vh; }
    100% { background-position: 20px -100px, 50px -100px, 0px -100px; }
}

/* --- 2. THÈME FORÊT : LUCIOLES --- */
.forest-fireflies {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    pointer-events: none;
    overflow: hidden;
}

.theme-forest .forest-fireflies {
    display: block;
}

.firefly {
    position: absolute;
    border-radius: 50%;
    background-color: #bef264; /* Lime-300 */
    box-shadow: 0 0 10px 2px rgba(190, 242, 100, 0.4);
    opacity: 0;
    animation: firefly-float 15s infinite ease-in-out;
}

/* On crée quelques lucioles manuelles via CSS */
.firefly:nth-child(1) { width: 4px; height: 4px; left: 10%; top: 50%; animation-duration: 8s; animation-delay: 0s; }
.firefly:nth-child(2) { width: 6px; height: 6px; left: 80%; top: 20%; animation-duration: 12s; animation-delay: 2s; }
.firefly:nth-child(3) { width: 3px; height: 3px; left: 40%; top: 70%; animation-duration: 15s; animation-delay: 1s; }
.firefly:nth-child(4) { width: 5px; height: 5px; left: 70%; top: 80%; animation-duration: 10s; animation-delay: 4s; }
.firefly:nth-child(5) { width: 4px; height: 4px; left: 20%; top: 30%; animation-duration: 18s; animation-delay: 3s; }

@keyframes firefly-float {
    0%, 100% { transform: translate(0, 0); opacity: 0; }
    20% { opacity: 0.8; }
    50% { transform: translate(50px, -50px); opacity: 0.5; }
    80% { opacity: 0.8; }
}

/* --- 3. THÈME CYBERPUNK/NEON : GRILLE RÉTRO --- */
.cyber-grid {
    display: none;
    position: fixed;
    bottom: -30%; /* Commence plus bas pour l'effet de perspective */
    left: -50%;
    width: 200%;
    height: 100%;
    z-index: 0;
    pointer-events: none;
    
    /* Grille en perspective */
    transform: perspective(500px) rotateX(60deg);
    
    background-image: 
        linear-gradient(transparent 95%, rgba(234, 179, 8, 0.3) 95%), /* Lignes horizontales jaunes */
        linear-gradient(90deg, transparent 95%, rgba(234, 179, 8, 0.3) 95%); /* Lignes verticales */
    background-size: 40px 40px;
    
    /* Masque pour que la grille disparaisse au fond */
    mask-image: linear-gradient(to top, black 40%, transparent 100%);
    -webkit-mask-image: linear-gradient(to top, black 40%, transparent 100%);

    animation: grid-move 5s linear infinite;
}

/* Changement de couleur pour le thème Neon (Violet) */
.theme-neon .cyber-grid {
    display: block;
    background-image: 
        linear-gradient(transparent 95%, rgba(168, 85, 247, 0.3) 95%),
        linear-gradient(90deg, transparent 95%, rgba(168, 85, 247, 0.3) 95%);
}

.theme-cyberpunk .cyber-grid {
    display: block;
    /* Garde le jaune par défaut défini ci-dessus */
}

@keyframes grid-move {
    0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
    100% { transform: perspective(500px) rotateX(60deg) translateY(40px); }
}

/* =========================================
   CORRECTION DES THÈMES SPÉCIAUX
   ========================================= */

/* --- 1. THÈME RETROWAVE --- */
.theme-retrowave .bg-deep-space {
    background-color: #0f0518 !important;
    /* On force l'image avec une grille */
    background-image: 
        linear-gradient(rgba(255, 0, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 0, 255, 0.1) 1px, transparent 1px) !important;
    background-size: 40px 40px !important;
    background-position: center bottom;
    background-attachment: scroll !important;
    animation: gridMove 20s linear infinite;
}
/* Horizon violet */
.theme-retrowave .bg-deep-space::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(to bottom, #0f0518 0%, transparent 80%);
    pointer-events: none;
    z-index: 0; 
}


/* --- 2. THÈME HACKER (TERMINAL / MATRIX) --- */
.theme-hacker .bg-deep-space {
    background-color: #050505 !important; /* Noir presque pur */
    font-family: 'Courier New', Courier, monospace !important;
    
    /* 1. TEXTE LISIBLE (Gris clair par défaut) */
    color: #e0e0e0 !important; 
    
    /* 2. FOND : Simulation de "Pluie Matrix" via dégradés */
    background-image: 
        /* Colonnes aléatoires simulées par des dégradés verticaux */
        linear-gradient(180deg, transparent 0%, rgba(0, 255, 0, 0.1) 50%, transparent 100%),
        /* Une grille fine pour le côté "Techno" */
        linear-gradient(90deg, rgba(0, 255, 0, 0.03) 1px, transparent 1px) !important;
        
    background-size: 100% 200%, 40px 100% !important; /* La pluie fait 200% de haut pour défiler */
    background-position: 0 -100%, 0 0 !important;
    background-attachment: scroll !important;
    
    animation: matrixRain 3s linear infinite;
    position: relative;
}

/* Animation de la pluie qui tombe */
@keyframes matrixRain {
    0% { background-position: 0 -100%, 0 0; }
    100% { background-position: 0 100%, 0 0; }
}

/* 3. ACCENTS MATRIX (Titres, Gras, Icônes en Vert Fluo) */
.theme-hacker .bg-deep-space h1,
.theme-hacker .bg-deep-space h2,
.theme-hacker .bg-deep-space h3,
.theme-hacker .bg-deep-space h4,
.theme-hacker .bg-deep-space strong,
.theme-hacker .bg-deep-space b,
.theme-hacker .bg-deep-space .lucide-icon, /* Cible les icônes lucide */
.theme-hacker .bg-deep-space svg {
    color: #00ff00 !important;
    fill: #00ff00; /* Remplit les icônes si besoin */
    text-shadow: 0 0 8px rgba(0, 255, 0, 0.6); /* Petit effet néon */
    border-color: rgba(0, 255, 0, 0.5) !important;
}

/* 4. OVERLAY SCANLINES (Lignes TV Retro) */
.theme-hacker .bg-deep-space::after {
    content: " ";
    display: block;
    position: fixed; 
    top: 0; left: 0; bottom: 0; right: 0;
    /* Lignes horizontales fines + vignette sombre sur les bords */
    background: 
        linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
        radial-gradient(circle, transparent 60%, black 150%);
    
    background-size: 100% 3px, 100% 100%;
    z-index: 999; 
    pointer-events: none;
    opacity: 0.2; /* Discret pour ne pas gêner la lecture */
}

/* --- 3. THÈME AURORA --- */
.theme-aurora .bg-deep-space {
    /* On sépare les propriétés pour être sûr d'écraser le défaut */
    background-color: #0f172a !important;
    background-image: linear-gradient(-45deg, #0f172a, #134e4a, #312e81, #0f172a) !important;
    background-size: 400% 400% !important;
    background-attachment: scroll !important; /* Fixed pose parfois problème avec l'anim */
    
    animation: auroraGradient 15s ease infinite;
}

/* Définition de l'animation (doit être présente) */
@keyframes auroraGradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
@keyframes gridMove {
    0% { background-position: 0 0; }
    100% { background-position: 0 40px; }
}

/* --- THÈME HOLOGRAPHIC --- */
.theme-holographic .bg-deep-space {
    background-color: #f3f4f6 !important; /* Gris très clair */
    /* Dégradé arc-en-ciel pastel géant qui tourne */
    background-image: 
        linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%),
        radial-gradient(at 0% 0%, rgba(255, 0, 150, 0.1) 0px, transparent 50%),
        radial-gradient(at 100% 100%, rgba(0, 255, 255, 0.1) 0px, transparent 50%) !important;
    position: relative;
    overflow: hidden;
    color: #1f2937 !important; /* Texte foncé pour la lisibilité sur fond clair */
}

/* Texte foncé forcé */
.theme-holographic .bg-deep-space * {
    color: #374151;
    border-color: rgba(255, 255, 255, 0.5);
}
.theme-holographic .bg-deep-space h1, 
.theme-holographic .bg-deep-space h2, 
.theme-holographic .bg-deep-space strong {
    color: #111827 !important;
}

/* L'effet aurore boréale holographique */
.theme-holographic .bg-deep-space::before {
    content: '';
    position: fixed;
    top: -50%; left: -50%; right: -50%; bottom: -50%;
    background: conic-gradient(
        from 0deg,
        transparent 0deg,
        rgba(168, 85, 247, 0.15) 60deg,
        rgba(56, 189, 248, 0.15) 120deg,
        rgba(236, 72, 153, 0.15) 180deg,
        rgba(56, 189, 248, 0.15) 240deg,
        rgba(168, 85, 247, 0.15) 300deg,
        transparent 360deg
    );
    animation: holoSpin 20s linear infinite;
    pointer-events: none;
    z-index: 0;
    filter: blur(60px); /* Flou énorme pour fondre les couleurs */
}

@keyframes holoSpin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* --- THÈME MAGMA --- */
.theme-magma .bg-deep-space {
    background-color: #2a0a0a !important; /* Rouge très sombre */
    background-image: none !important;
    position: relative;
    overflow: hidden;
}

/* Blob 1 */
.theme-magma .bg-deep-space::before {
    content: '';
    position: fixed;
    top: 50%; left: 50%;
    width: 60vw; height: 60vw;
    background: radial-gradient(circle, rgba(220, 38, 38, 0.4) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    animation: magmaMove1 15s ease-in-out infinite alternate;
    z-index: 0;
    pointer-events: none;
}

/* Blob 2 (Orange) */
.theme-magma .bg-deep-space::after {
    content: '';
    position: fixed;
    top: 20%; left: 20%;
    width: 40vw; height: 40vw;
    background: radial-gradient(circle, rgba(251, 146, 60, 0.3) 0%, transparent 70%);
    animation: magmaMove2 20s ease-in-out infinite alternate;
    z-index: 0;
    pointer-events: none;
}

@keyframes magmaMove1 {
    0% { transform: translate(-50%, -50%) scale(1); }
    100% { transform: translate(-30%, -60%) scale(1.2); }
}
@keyframes magmaMove2 {
    0% { transform: translate(0, 0) scale(1); }
    100% { transform: translate(50vw, 20vh) scale(0.8); }
}

/* --- THÈME QUANTUM --- */
.theme-quantum .bg-deep-space {
    background-color: #020617 !important;
    /* Motif de points */
    background-image: radial-gradient(rgba(56, 189, 248, 0.2) 2px, transparent 2px) !important;
    background-size: 40px 40px !important;
    background-position: 0 0;
    animation: quantumPan 60s linear infinite;
    position: relative;
}

/* Effet de "vague" de lumière qui passe */
.theme-quantum .bg-deep-space::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(circle at 50% 50%, transparent 0%, rgba(2, 6, 23, 0.8) 100%);
    z-index: 1; /* Vignette pour assombrir les bords */
    pointer-events: none;
}

/* Une lueur qui se déplace */
.theme-quantum .bg-deep-space::after {
    content: '';
    position: fixed;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: radial-gradient(circle, rgba(56, 189, 248, 0.07) 0%, transparent 40%);
    animation: quantumPulse 10s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
}

@keyframes quantumPan {
    0% { background-position: 0 0; }
    100% { background-position: 100px 100px; }
}

@keyframes quantumPulse {
    0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.5; }
    50% { transform: translate(-10%, -10%) scale(1.1); opacity: 1; }
}